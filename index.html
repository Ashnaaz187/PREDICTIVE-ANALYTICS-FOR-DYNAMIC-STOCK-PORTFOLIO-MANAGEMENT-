<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Stock Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body.dark-mode { background-color: #121212; color: #f8f9fa; }
    .chart-card { background: #1e1e1e; border-radius: 12px; padding: 15px; margin-top: 20px; box-shadow: 0 0 10px #000; }
    .btn-toggle { position: fixed; top: 10px; right: 10px; }
  </style>
</head>
<body class="dark-mode">
  <button class="btn btn-secondary btn-toggle" onclick="toggleDarkMode()">ğŸŒ— Toggle Theme</button>

  <div class="container py-4">
    <h1 class="text-center mb-4">ğŸ“Š AI Stock Market Dashboard</h1>

    <form method="POST" class="card p-4 shadow">
      <div class="row g-3 align-items-center">
        <div class="col-md-4"><input type="text" class="form-control" name="stock" placeholder="Enter Stock Ticker (e.g. AAPL)" required></div>
        <div class="col-md-3"><input type="number" class="form-control" name="budget" placeholder="Budget (â‚¹)" required></div>
        <div class="col-md-3">
          <select class="form-select" name="risk_level">
            <option>Low</option>
            <option selected>Medium</option>
            <option>High</option>
          </select>
        </div>
        <div class="col-md-2"><button class="btn btn-success w-100">Analyze</button></div>
      </div>
    </form>

    {% if stock %}
      <div class="text-center mt-4">
        <h3>{{ stock }}</h3>
        <h5 style="color: {{ latest_color }}">{{ latest_trend }}</h5>
        <h4 style="color: {{ ai_color }}">AI Advice: {{ ai_advice }}</h4>
        <p class="text-info">{{ personalized_advice }}</p>
      </div>

      <div class="chart-card"><h5>ğŸ“Š Candlestick Chart</h5>{{ candle_chart|safe }}</div>
      <div class="chart-card"><h5>ğŸ“ˆ EMA Chart</h5>{{ ema_chart|safe }}</div>
      <div class="chart-card"><h5>ğŸ“‰ Daily % Change</h5>{{ pct_chart|safe }}</div>
      <div class="chart-card"><h5>ğŸ“Š RSI Chart</h5>{{ rsi_chart|safe }}</div>

      <h4 class="mt-4">ğŸ“† Next 5-Day Predictions</h4>
      <ul class="list-group">
        {% for t in next_5_days_trends %}
          <li class="list-group-item" style="color: {{ t.color }}">Day {{ t.day }} â†’ â‚¹{{ t.price }} ({{ t.trend }})</li>
        {% endfor %}
      </ul>

      <h4 class="mt-4">ğŸ’° Investment Summary</h4>
      <p>Investment: â‚¹{{ invest_amount }}</p>
      <p>Shares: {{ shares|round(2) }}</p>
      <p>Potential Profit: â‚¹{{ potential_profit|round(2) }}</p>
      <p>Potential Loss: â‚¹{{ potential_loss|round(2) }}</p>

      <a href="/download_report" class="btn btn-warning mt-3">â¬‡ï¸ Download Report (PDF)</a>

      <h4 class="mt-5">ğŸ“‚ Portfolio</h4>
      <table class="table table-dark table-striped">
        <tr><th>Stock</th><th>Invested</th><th>Shares</th><th>Price</th><th>Profit</th><th>Loss</th><th>AI Advice</th><th>Risk</th><th>Time</th></tr>
        {% for p in portfolio %}
          <tr>
            <td>{{ p.stock }}</td>
            <td>â‚¹{{ p.invested }}</td>
            <td>{{ p.shares }}</td>
            <td>â‚¹{{ p.current_price }}</td>
            <td style="color:#28a745">â‚¹{{ p.potential_profit }}</td>
            <td style="color:#dc3545">â‚¹{{ p.potential_loss }}</td>
            <td style="color:#FFD700">{{ p.ai_advice }}</td>
            <td>{{ p.risk_level }}</td>
            <td>{{ p.timestamp }}</td>
          </tr>
        {% endfor %}
      </table>
    {% endif %}
  </div>

  <script>
    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }
  </script>
</body>
</html>